# Quota Logging System - Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         User Interface                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ File Upload  â”‚  â”‚ OCR Results  â”‚  â”‚  Quota Monitor (UI)  â”‚ â”‚
â”‚  â”‚  Component   â”‚  â”‚   Display    â”‚  â”‚  - Dashboard         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  - Statistics        â”‚ â”‚
â”‚                                       â”‚  - Download/Clear    â”‚ â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application Layer                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      App.tsx                             â”‚  â”‚
â”‚  â”‚  - State Management                                      â”‚  â”‚
â”‚  â”‚  - File Processing Orchestration                         â”‚  â”‚
â”‚  â”‚  - Component Coordination                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Service Layer                             â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  geminiService.ts    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤  quotaLogger.ts      â”‚     â”‚
â”‚  â”‚                      â”‚         â”‚                      â”‚     â”‚
â”‚  â”‚  - API Integration   â”‚         â”‚  - Log Management    â”‚     â”‚
â”‚  â”‚  - OCR Processing    â”‚         â”‚  - Statistics        â”‚     â”‚
â”‚  â”‚  - Token Tracking    â”‚         â”‚  - Export Functions  â”‚     â”‚
â”‚  â”‚  - Cost Calculation  â”‚         â”‚  - Rate Limit Check  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                                    â”‚                â”‚
â”‚           â”‚ logSuccess()                       â”‚                â”‚
â”‚           â”‚ logError()                         â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      External Services                          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Google Gemini API   â”‚         â”‚  Browser localStorageâ”‚     â”‚
â”‚  â”‚                      â”‚         â”‚                      â”‚     â”‚
â”‚  â”‚  - OCR Processing    â”‚         â”‚  - Log Persistence   â”‚     â”‚
â”‚  â”‚  - Token Counting    â”‚         â”‚  - Session Storage   â”‚     â”‚
â”‚  â”‚  - Rate Limiting     â”‚         â”‚  - Data Retention    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

### 1. OCR Request Flow

```
User Uploads Images
       â”‚
       â–¼
App.tsx (handleProcessFiles)
       â”‚
       â–¼
geminiService.performOCR()
       â”‚
       â”œâ”€â–º Start Timer
       â”‚
       â”œâ”€â–º Call Gemini API
       â”‚        â”‚
       â”‚        â”œâ”€â–º Success
       â”‚        â”‚     â”‚
       â”‚        â”‚     â”œâ”€â–º Extract Token Counts
       â”‚        â”‚     â”œâ”€â–º Calculate Cost
       â”‚        â”‚     â””â”€â–º quotaLogger.logSuccess()
       â”‚        â”‚              â”‚
       â”‚        â”‚              â””â”€â–º Save to localStorage
       â”‚        â”‚
       â”‚        â””â”€â–º Error
       â”‚              â”‚
       â”‚              â””â”€â–º quotaLogger.logError()
       â”‚                       â”‚
       â”‚                       â””â”€â–º Save to localStorage
       â”‚
       â””â”€â–º Return Results to App
```

### 2. Quota Monitoring Flow

```
User Clicks "Quota" Button
       â”‚
       â–¼
QuotaMonitor Component Opens
       â”‚
       â”œâ”€â–º quotaLogger.getTodayLogs()
       â”‚        â”‚
       â”‚        â””â”€â–º Read from localStorage
       â”‚
       â”œâ”€â–º quotaLogger.getSummary()
       â”‚        â”‚
       â”‚        â””â”€â–º Calculate Statistics
       â”‚
       â”œâ”€â–º quotaLogger.getRateLimitWarning()
       â”‚        â”‚
       â”‚        â””â”€â–º Check Recent Activity
       â”‚
       â””â”€â–º Display Dashboard
```

### 3. Export Flow

```
User Clicks "Download TXT"
       â”‚
       â–¼
quotaLogger.downloadLogs()
       â”‚
       â”œâ”€â–º Get All Logs from localStorage
       â”‚
       â”œâ”€â–º Generate Summary
       â”‚
       â”œâ”€â–º Format as Text
       â”‚
       â”œâ”€â–º Create Blob
       â”‚
       â””â”€â–º Trigger Download
```

## Component Interactions

### geminiService.ts â†” quotaLogger.ts

```typescript
// In geminiService.ts

const startTime = Date.now();

try {
  const response = await ai.models.generateContent({...});
  
  // Success: Log to quotaLogger
  quotaLogger.logSuccess({
    model: 'gemini-3-pro-preview',
    filesProcessed: files.length,
    promptTokens: response.usageMetadata.promptTokenCount,
    outputTokens: response.usageMetadata.candidatesTokenCount,
    estimatedCost: totalCost,
    processingTimeMs: Date.now() - startTime
  });
  
} catch (error) {
  // Error: Log to quotaLogger
  quotaLogger.logError({
    model: 'gemini-3-pro-preview',
    filesProcessed: files.length,
    errorMessage: error.message,
    processingTimeMs: Date.now() - startTime
  });
}
```

### App.tsx â†” QuotaMonitor.tsx

```typescript
// In App.tsx

import QuotaMonitor from './components/QuotaMonitor';

return (
  <div>
    {/* Main app content */}
    
    {/* Quota Monitor - Always rendered */}
    <QuotaMonitor />
  </div>
);
```

## Data Storage Structure

### localStorage Keys

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ localStorage                                            â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Key: "gemini_quota_logs"                        â”‚   â”‚
â”‚  â”‚ Value: JSON Array of QuotaLogEntry[]            â”‚   â”‚
â”‚  â”‚ Size: ~500KB (last 1,000 entries)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Key: "gemini_file_logs"                         â”‚   â”‚
â”‚  â”‚ Value: Plain text log lines                     â”‚   â”‚
â”‚  â”‚ Size: ~2MB (last 10,000 lines)                  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Key: "ocr_master_grid"                          â”‚   â”‚
â”‚  â”‚ Value: JSON Array of ExportRow[]                â”‚   â”‚
â”‚  â”‚ Size: Variable (user data)                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### sessionStorage Keys

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ sessionStorage                                          â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Key: "gemini_session_id"                        â”‚   â”‚
â”‚  â”‚ Value: "session_1732445723456_abc123"           â”‚   â”‚
â”‚  â”‚ Purpose: Track requests within browser session  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Log Entry Structure

```typescript
interface QuotaLogEntry {
  timestamp: string;           // "2025-11-24T10:30:45.123Z"
  sessionId: string;           // "session_1732445723456_abc123"
  model: string;               // "gemini-3-pro-preview"
  filesProcessed: number;      // 3
  promptTokens: number;        // 15000
  outputTokens: number;        // 2000
  totalTokens: number;         // 17000
  estimatedCost: number;       // 0.0735
  status: string;              // "success" | "error" | "rate_limited"
  errorMessage?: string;       // "The model is overloaded..."
  processingTimeMs: number;    // 4500
}
```

## Statistics Calculation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ getSummary() Function                                   â”‚
â”‚                                                         â”‚
â”‚  Input: QuotaLogEntry[]                                 â”‚
â”‚                                                         â”‚
â”‚  Process:                                               â”‚
â”‚  1. Count total requests                                â”‚
â”‚  2. Filter by status (success/error/rate_limited)       â”‚
â”‚  3. Sum all tokens (prompt + output)                    â”‚
â”‚  4. Sum all costs                                       â”‚
â”‚  5. Calculate average processing time                   â”‚
â”‚  6. Find first and last timestamps                      â”‚
â”‚                                                         â”‚
â”‚  Output: QuotaSummary                                   â”‚
â”‚  {                                                      â”‚
â”‚    totalRequests: 45,                                   â”‚
â”‚    successfulRequests: 42,                              â”‚
â”‚    failedRequests: 1,                                   â”‚
â”‚    rateLimitedRequests: 2,                              â”‚
â”‚    totalPromptTokens: 675000,                           â”‚
â”‚    totalOutputTokens: 90000,                            â”‚
â”‚    totalTokens: 765000,                                 â”‚
â”‚    totalCost: 3.2475,                                   â”‚
â”‚    averageProcessingTime: 4250,                         â”‚
â”‚    firstRequest: "2025-11-24T08:00:00.000Z",            â”‚
â”‚    lastRequest: "2025-11-24T10:30:00.000Z"              â”‚
â”‚  }                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Rate Limit Detection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rate Limit Detection Logic                             â”‚
â”‚                                                         â”‚
â”‚  Error Message Contains:                                â”‚
â”‚  â”œâ”€â–º "503"                    â†’ rate_limited            â”‚
â”‚  â”œâ”€â–º "overloaded"             â†’ rate_limited            â”‚
â”‚  â”œâ”€â–º "quota"                  â†’ rate_limited            â”‚
â”‚  â””â”€â–º "rate limit"             â†’ rate_limited            â”‚
â”‚                                                         â”‚
â”‚  Otherwise:                   â†’ error                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rate Limit Warning Logic                               â”‚
â”‚                                                         â”‚
â”‚  Check 1: Recent Activity                               â”‚
â”‚  â”œâ”€â–º Get logs from last 60 seconds                      â”‚
â”‚  â”œâ”€â–º Count requests                                     â”‚
â”‚  â””â”€â–º If count >= 10 â†’ Show warning                      â”‚
â”‚                                                         â”‚
â”‚  Check 2: Today's Rate Limits                           â”‚
â”‚  â”œâ”€â–º Get today's logs                                   â”‚
â”‚  â”œâ”€â–º Count rate_limited status                          â”‚
â”‚  â””â”€â–º If count > 0 â†’ Show warning                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Cost Calculation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cost Calculation Formula                               â”‚
â”‚                                                         â”‚
â”‚  Constants:                                             â”‚
â”‚  PRICE_PER_1M_INPUT_TOKENS = $3.50                      â”‚
â”‚  PRICE_PER_1M_OUTPUT_TOKENS = $10.50                    â”‚
â”‚                                                         â”‚
â”‚  Calculation:                                           â”‚
â”‚  inputCost = (promptTokens / 1,000,000) Ã— $3.50         â”‚
â”‚  outputCost = (outputTokens / 1,000,000) Ã— $10.50       â”‚
â”‚  totalCost = inputCost + outputCost                     â”‚
â”‚                                                         â”‚
â”‚  Example:                                               â”‚
â”‚  promptTokens = 15,000                                  â”‚
â”‚  outputTokens = 2,000                                   â”‚
â”‚                                                         â”‚
â”‚  inputCost = (15,000 / 1,000,000) Ã— 3.50 = $0.0525      â”‚
â”‚  outputCost = (2,000 / 1,000,000) Ã— 10.50 = $0.0210     â”‚
â”‚  totalCost = $0.0735                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Export Formats

### TXT Format

```
=== QUOTA USAGE SUMMARY ===
[Summary statistics]

=== DETAILED LOGS ===
timestamp | session | status | model | files=X | tokens=X | cost=$X | time=Xms
timestamp | session | status | model | files=X | tokens=X | cost=$X | time=Xms
...
```

### JSON Format

```json
{
  "summary": {
    "totalRequests": 45,
    "successfulRequests": 42,
    ...
  },
  "logs": [
    {
      "timestamp": "2025-11-24T10:30:45.123Z",
      "sessionId": "session_...",
      "status": "success",
      ...
    }
  ],
  "exportedAt": "2025-11-24T15:00:00.000Z"
}
```

## Performance Characteristics

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Operation Performance                                   â”‚
â”‚                                                         â”‚
â”‚  logSuccess()           <1ms                            â”‚
â”‚  logError()             <1ms                            â”‚
â”‚  getAllLogs()           <5ms                            â”‚
â”‚  getSummary()           <10ms                           â”‚
â”‚  downloadLogs()         <50ms                           â”‚
â”‚  QuotaMonitor render    <50ms                           â”‚
â”‚                                                         â”‚
â”‚  Total overhead per API call: <1ms (negligible)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security & Privacy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Data Privacy                                            â”‚
â”‚                                                         â”‚
â”‚  âœ… Stored Locally:                                     â”‚
â”‚     - Timestamps                                        â”‚
â”‚     - Token counts                                      â”‚
â”‚     - Costs                                             â”‚
â”‚     - Processing times                                  â”‚
â”‚     - Generic error messages                            â”‚
â”‚                                                         â”‚
â”‚  âŒ NOT Stored:                                         â”‚
â”‚     - API keys                                          â”‚
â”‚     - File contents                                     â”‚
â”‚     - OCR results                                       â”‚
â”‚     - User data                                         â”‚
â”‚     - Personal information                              â”‚
â”‚                                                         â”‚
â”‚  ğŸ”’ Security:                                           â”‚
â”‚     - All data stays in browser                         â”‚
â”‚     - No external transmission                          â”‚
â”‚     - User has full control                             â”‚
â”‚     - Can clear anytime                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Scalability

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Storage Limits & Cleanup                               â”‚
â”‚                                                         â”‚
â”‚  Structured Logs:                                       â”‚
â”‚  â”œâ”€â–º Max entries: 1,000                                 â”‚
â”‚  â”œâ”€â–º Cleanup: FIFO (First In, First Out)               â”‚
â”‚  â””â”€â–º Size: ~500KB                                       â”‚
â”‚                                                         â”‚
â”‚  File Logs:                                             â”‚
â”‚  â”œâ”€â–º Max lines: 10,000                                  â”‚
â”‚  â”œâ”€â–º Cleanup: FIFO                                      â”‚
â”‚  â””â”€â–º Size: ~2MB                                         â”‚
â”‚                                                         â”‚
â”‚  Total Storage: ~2.5MB                                  â”‚
â”‚  Browser Limit: 5-10MB (well within limits)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Error Handling Strategy                                â”‚
â”‚                                                         â”‚
â”‚  localStorage Full:                                     â”‚
â”‚  â”œâ”€â–º Try to save                                        â”‚
â”‚  â”œâ”€â–º If fails, log to console                           â”‚
â”‚  â””â”€â–º Continue operation (graceful degradation)          â”‚
â”‚                                                         â”‚
â”‚  localStorage Disabled:                                 â”‚
â”‚  â”œâ”€â–º Detect on first save attempt                       â”‚
â”‚  â”œâ”€â–º Log warning to console                             â”‚
â”‚  â””â”€â–º App continues without logging                      â”‚
â”‚                                                         â”‚
â”‚  Invalid Data:                                          â”‚
â”‚  â”œâ”€â–º Try to parse JSON                                  â”‚
â”‚  â”œâ”€â–º If fails, return empty array                       â”‚
â”‚  â””â”€â–º Log error to console                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Last Updated:** November 24, 2025
